---
/**
 * Contact Page - /contact/
 * Best-in-class contact page with multiple channels, department routing,
 * and a clean submission form
 */

export const prerender = true

import BaseLayout from '../../layouts/BaseLayout.astro'
import { getLogoUrl, getSouthlandImageId, getCloudinaryResponsiveSet } from '../../lib/cloudinary'

const siteUrl = import.meta.env.PUBLIC_SITE_URL || 'https://southlandorganics.com'

// Hero background photos ‚Äî same curated pool as podcast page
const heroImagePaths = [
  'heroes/Farm_Athens_GA_7_jbdjik',
  'heroes/Farm_Athens_GA_4_qaishv',
  'heroes/Farm_Athens_GA_11_pntmj0',
  'heroes/DSC_0137_dco2wk',
]
const heroImages = heroImagePaths.map((path) =>
  getCloudinaryResponsiveSet(getSouthlandImageId(path), [800, 1200, 1600, 1920], {
    crop: 'fill',
    quality: 'auto',
    format: 'auto',
    effect: ['saturation:60', 'brightness:80'],
  })
)

const contactSchema = {
  '@context': 'https://schema.org',
  '@type': 'ContactPage',
  name: 'Contact Southland Organics',
  description:
    'Get in touch with Southland Organics. Reach our poultry team, lawn & garden specialists, or customer service.',
  url: `${siteUrl}/contact/`,
  mainEntity: {
    '@type': 'Organization',
    name: 'Southland Organics',
    url: siteUrl,
    telephone: '+1-800-608-3755',
    address: {
      '@type': 'PostalAddress',
      streetAddress: '189 Luke Road',
      addressLocality: 'Bogart',
      addressRegion: 'GA',
      postalCode: '30622',
      addressCountry: 'US',
    },
    contactPoint: [
      {
        '@type': 'ContactPoint',
        telephone: '+1-800-608-3755',
        contactType: 'sales',
        areaServed: 'US',
        availableLanguage: 'English',
      },
      {
        '@type': 'ContactPoint',
        telephone: '+1-800-608-3755',
        contactType: 'customer service',
        areaServed: 'US',
        availableLanguage: 'English',
      },
    ],
  },
}
---

<BaseLayout
  title="Contact Us | Southland Organics"
  description="Get in touch with Southland Organics. Reach our poultry team, lawn & garden specialists, or customer service. Call 800-608-3755 or send us a message."
  ogImage={getLogoUrl('square', { width: 800 })}
  schema={contactSchema}
>
  <!-- Hero with rotating farm photos -->
  <section class="contact-hero relative overflow-hidden">
    <!-- Background photo - randomly selected farm scene -->
    <img
      id="hero-bg"
      alt=""
      class="absolute inset-0 h-full w-full object-cover"
      loading="eager"
      decoding="async"
      fetchpriority="high"
    />
    <script is:inline define:vars={{ heroImages }}>
      var pick = heroImages[Math.floor(Math.random() * heroImages.length)]
      var el = document.getElementById('hero-bg')
      if (el) {
        el.src = pick.src
        el.srcset = pick.srcset
        el.sizes = '100vw'
      }
    </script>
    <!-- Dark gradient overlay -->
    <div class="absolute inset-0" aria-hidden="true">
      <div
        class="absolute inset-0 bg-gradient-to-b from-[#1a3a21]/80 via-[#2c5234]/70 to-[#1a2f1e]/85"
      >
      </div>
      <div
        class="absolute inset-0 bg-gradient-to-br from-[#3d2b1f]/15 via-transparent to-[#2c1810]/10"
      >
      </div>
    </div>
    <div class="relative z-10 mx-auto max-w-7xl px-4 py-16 text-center sm:px-6 md:py-20 lg:px-8">
      <p class="mb-3 text-sm font-medium uppercase tracking-widest text-southland-green">
        We're Here to Help
      </p>
      <h1 class="mb-4 font-heading text-4xl text-white md:text-5xl">Get in Touch</h1>
      <p class="mx-auto max-w-2xl text-lg text-white/80">
        Whether you need product advice, want to become a dealer, or just have a question ‚Äî we'd
        love to hear from you.
      </p>
    </div>
  </section>

  <!-- Quick Contact Cards -->
  <section class="relative -mt-8 pb-8">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="grid gap-4 md:mx-auto md:max-w-2xl md:grid-cols-2">
        <!-- Call -->
        <a
          href="tel:+18006083755"
          class="group flex items-start gap-4 rounded-2xl bg-white p-6 shadow-lg transition-all hover:shadow-xl"
        >
          <div
            class="flex h-12 w-12 shrink-0 items-center justify-center rounded-xl bg-southland-green/10 transition-colors group-hover:bg-southland-green/20"
          >
            <svg
              class="h-6 w-6 text-southland-green"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"
              ></path>
            </svg>
          </div>
          <div>
            <h3 class="font-bold text-shopify-title">Call Us</h3>
            <p class="text-lg font-semibold text-southland-green">800-608-3755</p>
            <p class="text-sm text-shopify-secondary-text">Mon-Fri, 8am-5pm EST</p>
          </div>
        </a>

        <!-- Location -->
        <div class="flex items-start gap-4 rounded-2xl bg-white p-6 shadow-lg">
          <div
            class="flex h-12 w-12 shrink-0 items-center justify-center rounded-xl bg-southland-green/10"
          >
            <svg
              class="h-6 w-6 text-southland-green"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
              ></path>
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
            </svg>
          </div>
          <div>
            <h3 class="font-bold text-shopify-title">Visit Us</h3>
            <p class="text-sm text-shopify-secondary-text">
              189 Luke Road<br />
              Bogart, GA 30622
            </p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Main Content: Form + Department Contacts -->
  <section class="bg-brand-gray py-16 md:py-24">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="grid gap-12 lg:grid-cols-5">
        <!-- Contact Form -->
        <div class="lg:col-span-3">
          <div class="rounded-2xl bg-white p-8 shadow-sm md:p-10">
            <h2 class="mb-2 text-2xl font-bold text-shopify-title">Send Us a Message</h2>
            <p class="mb-8 text-shopify-secondary-text">
              Fill out the form below and we'll get back to you as soon as possible.
            </p>

            <form id="contact-form" class="space-y-6">
              <div class="grid gap-6 sm:grid-cols-2">
                <div>
                  <label
                    for="first-name"
                    class="mb-1.5 block text-sm font-medium text-shopify-title"
                    >First Name <span class="text-red-500">*</span></label
                  >
                  <input
                    type="text"
                    id="first-name"
                    name="firstName"
                    required
                    class="w-full rounded-lg border border-gray-300 px-4 py-3 text-shopify-title transition-colors focus:border-southland-green focus:outline-none focus:ring-2 focus:ring-southland-green/20"
                    placeholder="First name"
                  />
                </div>
                <div>
                  <label for="last-name" class="mb-1.5 block text-sm font-medium text-shopify-title"
                    >Last Name <span class="text-red-500">*</span></label
                  >
                  <input
                    type="text"
                    id="last-name"
                    name="lastName"
                    required
                    class="w-full rounded-lg border border-gray-300 px-4 py-3 text-shopify-title transition-colors focus:border-southland-green focus:outline-none focus:ring-2 focus:ring-southland-green/20"
                    placeholder="Last name"
                  />
                </div>
              </div>

              <div class="grid gap-6 sm:grid-cols-2">
                <div>
                  <label for="email" class="mb-1.5 block text-sm font-medium text-shopify-title"
                    >Email <span class="text-red-500">*</span></label
                  >
                  <input
                    type="email"
                    id="email"
                    name="email"
                    required
                    class="w-full rounded-lg border border-gray-300 px-4 py-3 text-shopify-title transition-colors focus:border-southland-green focus:outline-none focus:ring-2 focus:ring-southland-green/20"
                    placeholder="you@example.com"
                  />
                </div>
                <div>
                  <label for="phone" class="mb-1.5 block text-sm font-medium text-shopify-title"
                    >Phone</label
                  >
                  <input
                    type="tel"
                    id="phone"
                    name="phone"
                    class="w-full rounded-lg border border-gray-300 px-4 py-3 text-shopify-title transition-colors focus:border-southland-green focus:outline-none focus:ring-2 focus:ring-southland-green/20"
                    placeholder="(555) 555-5555"
                  />
                </div>
              </div>

              <div>
                <label for="department" class="mb-1.5 block text-sm font-medium text-shopify-title"
                  >I need help with... <span class="text-red-500">*</span></label
                >
                <select
                  id="department"
                  name="department"
                  required
                  class="w-full rounded-lg border border-gray-300 px-4 py-3 text-shopify-title transition-colors focus:border-southland-green focus:outline-none focus:ring-2 focus:ring-southland-green/20"
                >
                  <option value="">Select a topic</option>
                  <option value="poultry">Poultry Products & Support</option>
                  <option value="lawn">Lawn & Garden Products</option>
                  <option value="turf">Turf Professional Solutions</option>
                  <option value="dealer">Becoming a Dealer</option>
                  <option value="distribution">Distribution & Wholesale</option>
                  <option value="order">Order Status & Shipping</option>
                  <option value="other">Something Else</option>
                </select>
              </div>

              <div>
                <label for="message" class="mb-1.5 block text-sm font-medium text-shopify-title"
                  >Message <span class="text-red-500">*</span></label
                >
                <textarea
                  id="message"
                  name="message"
                  rows="5"
                  required
                  class="w-full resize-none rounded-lg border border-gray-300 px-4 py-3 text-shopify-title transition-colors focus:border-southland-green focus:outline-none focus:ring-2 focus:ring-southland-green/20"
                  placeholder="Tell us how we can help..."></textarea>
              </div>

              <!-- Honeypot ‚Äî hidden from humans, bots fill it -->
              <input
                name="website"
                type="text"
                style="display:none"
                tabindex="-1"
                autocomplete="off"
              />

              <button
                type="submit"
                class="inline-flex w-full items-center justify-center gap-2 rounded-lg bg-southland-green px-8 py-4 text-base font-bold text-white shadow-sm transition-all hover:bg-[#3a7534] hover:shadow-md active:scale-[0.98] sm:w-auto"
              >
                Send Message
                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
                </svg>
              </button>
            </form>

            <!-- Success Message (hidden by default) -->
            <div id="form-success" class="hidden py-12 text-center">
              <div
                class="mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-southland-green/10"
              >
                <svg
                  class="h-8 w-8 text-southland-green"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M5 13l4 4L19 7"></path>
                </svg>
              </div>
              <h3 class="mb-2 text-2xl font-bold text-shopify-title">Message Sent!</h3>
              <p class="text-shopify-secondary-text">
                We'll get back to you within 24 hours. If your matter is urgent, call us at
                <a href="tel:+18006083755" class="font-semibold text-southland-green"
                  >800-608-3755</a
                >.
              </p>
            </div>

            <!-- Error Message (hidden by default) -->
            <div id="form-error" class="mt-4 hidden rounded-lg bg-red-50 p-4 text-sm text-red-700">
              Something went wrong. Please try again or call us directly at
              <a href="tel:+18006083755" class="font-semibold underline">800-608-3755</a>.
            </div>
          </div>
        </div>

        <!-- Right Sidebar: Department Contacts -->
        <div class="space-y-6 lg:col-span-2">
          <!-- Poultry -->
          <div class="rounded-2xl bg-white p-6 shadow-sm">
            <div class="mb-3 flex items-center gap-3">
              <div
                class="flex h-10 w-10 items-center justify-center rounded-lg bg-southland-green/10 text-lg"
              >
                üêî
              </div>
              <h3 class="text-lg font-bold text-shopify-title">Poultry Team</h3>
            </div>
            <p class="mb-3 text-sm text-shopify-secondary-text">
              Talk to Allen Reynolds about litter treatments, water line solutions, and biosecurity.
            </p>
            <a
              href="tel:+18006083755"
              class="flex items-center gap-2 text-sm font-medium text-southland-green hover:underline"
            >
              <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"
                ></path>
              </svg>
              800-608-3755
            </a>
          </div>

          <!-- Lawn & Garden -->
          <div class="rounded-2xl bg-white p-6 shadow-sm">
            <div class="mb-3 flex items-center gap-3">
              <div
                class="flex h-10 w-10 items-center justify-center rounded-lg bg-southland-green/10 text-lg"
              >
                üå±
              </div>
              <h3 class="text-lg font-bold text-shopify-title">Lawn & Garden</h3>
            </div>
            <p class="mb-3 text-sm text-shopify-secondary-text">
              Soil conditioning, organic lawn care, and turf professional programs.
            </p>
            <a
              href="tel:+18006083755"
              class="flex items-center gap-2 text-sm font-medium text-southland-green hover:underline"
            >
              <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"
                ></path>
              </svg>
              800-608-3755
            </a>
          </div>

          <!-- Dealers -->
          <div class="rounded-2xl bg-white p-6 shadow-sm">
            <div class="mb-3 flex items-center gap-3">
              <div
                class="flex h-10 w-10 items-center justify-center rounded-lg bg-southland-green/10 text-lg"
              >
                ü§ù
              </div>
              <h3 class="text-lg font-bold text-shopify-title">Become a Dealer</h3>
            </div>
            <p class="mb-3 text-sm text-shopify-secondary-text">
              Interested in carrying Southland Organics products? Let's talk.
            </p>
            <a
              href="/distribution/"
              class="flex items-center gap-2 text-sm font-medium text-southland-green hover:underline"
            >
              Learn about our dealer program
              <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 5l7 7-7 7"></path>
              </svg>
            </a>
          </div>

          <!-- Orders -->
          <div class="rounded-2xl bg-white p-6 shadow-sm">
            <div class="mb-3 flex items-center gap-3">
              <div
                class="flex h-10 w-10 items-center justify-center rounded-lg bg-southland-green/10 text-lg"
              >
                üì¶
              </div>
              <h3 class="text-lg font-bold text-shopify-title">Order Support</h3>
            </div>
            <p class="mb-3 text-sm text-shopify-secondary-text">
              Questions about your order, shipping, or returns.
            </p>
            <a
              href="tel:+18006083755"
              class="flex items-center gap-2 text-sm font-medium text-southland-green hover:underline"
            >
              <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"
                ></path>
              </svg>
              800-608-3755
            </a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Map Section -->
  <section class="bg-white py-16">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="grid items-center gap-8 lg:grid-cols-2">
        <div>
          <h2 class="mb-4 text-3xl font-bold text-shopify-title">Based in Georgia</h2>
          <p class="mb-2 text-lg text-shopify-secondary-text">
            Southland Organics is headquartered in Bogart, Georgia.
          </p>
          <p class="mb-6 text-lg text-shopify-secondary-text">
            We ship nationwide and have a strong <a
              href="/store-locator/"
              class="font-semibold text-southland-green hover:underline">dealer network</a
            >.
          </p>
          <div class="space-y-3 text-shopify-secondary-text">
            <div class="flex items-start gap-3">
              <svg
                class="mt-0.5 h-5 w-5 shrink-0 text-southland-green"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                ></path>
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
              </svg>
              <span>189 Luke Road, Bogart, GA 30622</span>
            </div>
            <div class="flex items-start gap-3">
              <svg
                class="mt-0.5 h-5 w-5 shrink-0 text-southland-green"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <span>Monday-Friday, 8:00 AM - 5:00 PM EST</span>
            </div>
            <div class="flex items-start gap-3">
              <svg
                class="mt-0.5 h-5 w-5 shrink-0 text-southland-green"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"
                ></path>
              </svg>
              <span>800-608-3755</span>
            </div>
          </div>
        </div>
        <div class="overflow-hidden rounded-2xl shadow-lg">
          <iframe
            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3267.5!2d-83.5344!3d33.9468!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x0!2s189+Luke+Road%2C+Bogart%2C+GA+30622!5e0!3m2!1sen!2sus!4v1"
            width="100%"
            height="400"
            style="border:0;"
            allowfullscreen=""
            loading="lazy"
            referrerpolicy="no-referrer-when-downgrade"
            title="Southland Organics Location"></iframe>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>

<script>
  // Capture attribution params on page load ‚Üí sessionStorage
  ;(function captureAttribution() {
    const params = new URLSearchParams(window.location.search)
    const keys = ['gclid', 'utm_source', 'utm_medium', 'utm_campaign']
    keys.forEach((k) => {
      const v = params.get(k)
      if (v) sessionStorage.setItem(`sl_${k}`, v)
    })
    // Landing page ‚Äî only store on first page load (don't overwrite on nav)
    if (!sessionStorage.getItem('sl_landing_page')) {
      sessionStorage.setItem('sl_landing_page', window.location.pathname)
    }
  })()

  function getAttribution(): Record<string, string | null> {
    return {
      gclid: sessionStorage.getItem('sl_gclid'),
      utm_source: sessionStorage.getItem('sl_utm_source'),
      utm_medium: sessionStorage.getItem('sl_utm_medium'),
      utm_campaign: sessionStorage.getItem('sl_utm_campaign'),
      landing_page: sessionStorage.getItem('sl_landing_page'),
    }
  }

  const NEXUS_API = 'https://nexus.southlandorganics.com/api/leads'

  const form = document.getElementById('contact-form') as HTMLFormElement | null
  const successEl = document.getElementById('form-success')
  const errorEl = document.getElementById('form-error')

  if (form) {
    form.addEventListener('submit', async (e) => {
      e.preventDefault()

      const formData = new FormData(form)
      const data = Object.fromEntries(formData.entries())

      const submitBtn = form.querySelector('button[type="submit"]') as HTMLButtonElement
      if (submitBtn) {
        submitBtn.disabled = true
        submitBtn.textContent = 'Sending...'
      }

      try {
        // 1. Send branded email via internal API (primary)
        const res = await fetch('/api/form/submit', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ ...data, formType: 'contact' }),
        })

        if (!res.ok) throw new Error('Send failed')

        // 2. Dual-write to Nexus for lead tracking (non-blocking)
        const attr = getAttribution()
        fetch(NEXUS_API, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            source: 'website_form',
            form_type: 'contact',
            first_name: data.firstName || null,
            last_name: data.lastName || null,
            email: data.email || null,
            phone: data.phone || null,
            message: data.message || null,
            gclid: attr.gclid,
            utm_source: attr.utm_source,
            utm_medium: attr.utm_medium,
            utm_campaign: attr.utm_campaign,
            landing_page: attr.landing_page,
            website: data.website || '',
          }),
        }).catch(() => {}) // Fire-and-forget ‚Äî email is the primary path

        // Show success state
        form.classList.add('hidden')
        if (successEl) successEl.classList.remove('hidden')
        if (errorEl) errorEl.classList.add('hidden')
      } catch {
        if (errorEl) errorEl.classList.remove('hidden')
        if (submitBtn) {
          submitBtn.disabled = false
          submitBtn.textContent = 'Send Message'
        }
      }
    })
  }
</script>
