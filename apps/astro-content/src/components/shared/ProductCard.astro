---
/**
 * Product card component - links to Shopify product
 * Used for related products on episode pages
 */

interface Props {
  name: string
  slug: string
  description?: string
  image?: string
  cta?: string
  price?: string
  segment?: string
  class?: string
}

const {
  name,
  slug,
  description,
  image,
  cta = 'Shop Now',
  price,
  segment,
  class: className = '',
} = Astro.props

const siteUrl = import.meta.env.PUBLIC_SITE_URL || 'https://southlandorganics.com'
const productUrl = `${siteUrl}/products/${slug}`
const defaultImage = '/images/products/placeholder.jpg'
---

<div
  class={`product-card bg-white rounded-xl border border-gray-100 overflow-hidden hover:shadow-md transition-shadow ${className}`}
>
  {/* Product Image */}
  <a href={productUrl} class="relative block aspect-square overflow-hidden bg-gray-50">
    <img
      src={image || defaultImage}
      alt={name}
      class="h-full w-full object-cover transition-transform duration-300 hover:scale-105"
      loading="lazy"
    />
    {
      segment && (
        <span class="absolute left-2 top-2 rounded bg-southland-green px-2 py-1 text-xs font-medium text-white">
          {segment}
        </span>
      )
    }
  </a>

  {/* Product Info */}
  <div class="p-4">
    <a href={productUrl} class="block">
      <h4 class="font-semibold text-gray-900 transition-colors hover:text-southland-green">
        {name}
      </h4>
    </a>

    {description && <p class="mt-1 line-clamp-2 text-sm text-gray-600">{description}</p>}

    <div class="mt-4 flex items-center justify-between">
      {price && <span class="font-semibold text-gray-900">{price}</span>}
      <a
        href={productUrl}
        class="inline-flex items-center gap-1 text-sm font-medium text-southland-green transition-colors hover:text-southland-green-dark"
        data-product-slug={slug}
      >
        {cta}
        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"
          ></path>
        </svg>
      </a>
    </div>
  </div>
</div>

<script>
  // Track product clicks
  document.querySelectorAll('.product-card a[data-product-slug]').forEach((link) => {
    link.addEventListener('click', () => {
      const productSlug = (link as HTMLElement).dataset.productSlug
      if (window.pdPixel && productSlug) {
        window.pdPixel.track('product_cta_click', {
          product_slug: productSlug,
          source: 'podcast',
          page: window.location.pathname,
        })
      }
    })
  })
</script>
