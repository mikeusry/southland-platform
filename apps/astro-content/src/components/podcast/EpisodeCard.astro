---
/**
 * Episode card component for podcast hub and listings
 */

import TopicTag from '../shared/TopicTag.astro'

interface Props {
  title: string
  slug: string
  episodeNumber: number
  description: string
  thumbnail?: string
  duration: string
  publishDate: Date
  topics?: string[]
  featured?: boolean
  class?: string
}

const {
  title,
  slug,
  episodeNumber,
  description,
  thumbnail,
  duration,
  publishDate,
  topics = [],
  featured = false,
  class: className = '',
} = Astro.props

const episodeUrl = `/podcast/${slug}/`
// SVG data URI fallback — no external file dependency
const defaultThumbnail = `data:image/svg+xml,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 360" fill="none"><rect width="640" height="360" fill="%23f3f4f6"/><circle cx="320" cy="150" r="40" fill="%2344883e" opacity="0.2"/><path d="M308 130v40l30-20z" fill="%2344883e"/><text x="320" y="230" text-anchor="middle" fill="%2344883e" font-family="system-ui" font-size="16" font-weight="600">Southland Podcast</text></svg>')}`

// Format date
const formattedDate = new Intl.DateTimeFormat('en-US', {
  month: 'short',
  day: 'numeric',
  year: 'numeric',
}).format(publishDate)
---

<article
  class={`episode-card bg-white rounded-xl shadow-sm hover:shadow-lg hover:-translate-y-0.5 transition-all duration-200 overflow-hidden ${featured ? 'md:flex md:gap-0' : ''} ${className}`}
  data-episode-number={episodeNumber}
>
  {/* Thumbnail */}
  <a
    href={episodeUrl}
    class={`episode-card-thumbnail block relative group ${featured ? 'md:w-2/5 md:flex-shrink-0' : ''}`}
  >
    <div class={`aspect-video bg-gray-100 overflow-hidden ${featured ? '' : ''}`}>
      <img
        src={thumbnail || defaultThumbnail}
        alt={`Episode ${episodeNumber}: ${title}`}
        class="h-full w-full object-cover transition-transform duration-300 group-hover:scale-105"
        loading="lazy"
      />
    </div>

    {/* Play overlay */}
    <div
      class="absolute inset-0 flex items-center justify-center bg-black/20 opacity-0 transition-opacity group-hover:opacity-100"
    >
      <div class="flex h-16 w-16 items-center justify-center rounded-full bg-white/90 shadow-lg">
        <svg class="ml-1 h-6 w-6 text-southland-green" fill="currentColor" viewBox="0 0 24 24">
          <path d="M8 5v14l11-7z"></path>
        </svg>
      </div>
    </div>

    {/* Duration badge */}
    <div
      class="absolute bottom-3 right-3 rounded-md bg-black/80 px-2.5 py-1 text-xs font-medium text-white"
    >
      {duration}
    </div>
  </a>

  {/* Content */}
  <div
    class={`episode-card-content p-5 ${featured ? 'md:flex-1 md:p-6 md:flex md:flex-col md:justify-center' : ''}`}
  >
    {/* Episode number and date */}
    <div class="mb-2 flex items-center gap-2 text-sm text-gray-500">
      <span class="font-semibold text-southland-green">EP {episodeNumber}</span>
      <span>•</span>
      <time datetime={publishDate.toISOString()}>{formattedDate}</time>
    </div>

    {/* Title */}
    <h3 class={`font-bold text-gray-900 mb-2 line-clamp-2 ${featured ? 'text-2xl' : 'text-lg'}`}>
      <a href={episodeUrl} class="transition-colors hover:text-southland-green">
        {title}
      </a>
    </h3>

    {/* Description */}
    <p class={`text-gray-600 mb-4 ${featured ? 'line-clamp-3 text-base' : 'line-clamp-2 text-sm'}`}>
      {description}
    </p>

    {/* Topics */}
    {
      topics.length > 0 && (
        <div class="flex flex-wrap gap-2">
          {topics.slice(0, 3).map((topic) => (
            <TopicTag topic={topic} size="sm" />
          ))}
          {topics.length > 3 && (
            <span class="text-xs text-gray-500">+{topics.length - 3} more</span>
          )}
        </div>
      )
    }

    {/* Listen CTA for featured */}
    {
      featured && (
        <a
          href={episodeUrl}
          class="mt-4 inline-flex items-center gap-2 font-semibold text-southland-green transition-colors hover:text-southland-green-dark"
        >
          Listen Now
          <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 5l7 7-7 7"
            />
          </svg>
        </a>
      )
    }
  </div>
</article>
