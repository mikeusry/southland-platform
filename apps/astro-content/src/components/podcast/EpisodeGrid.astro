---
/**
 * Episode grid component - displays episodes in a responsive grid
 */

import EpisodeCard from './EpisodeCard.astro'
import { resolveEpisodeCover } from '../../lib/cloudinary'
import type { CollectionEntry } from 'astro:content'

interface Props {
  episodes: CollectionEntry<'episodes'>[]
  showFeatured?: boolean
  columns?: 2 | 3
  class?: string
}

const { episodes, showFeatured = false, columns = 3, class: className = '' } = Astro.props

// Sort by publish date (newest first)
const sortedEpisodes = [...episodes].sort(
  (a, b) => new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime()
)

const featuredEpisode = showFeatured ? sortedEpisodes[0] : null
const gridEpisodes = showFeatured ? sortedEpisodes.slice(1) : sortedEpisodes

const gridClasses =
  columns === 2 ? 'grid-cols-1 md:grid-cols-2' : 'grid-cols-1 md:grid-cols-2 lg:grid-cols-3'
---

<div class={`episode-grid ${className}`}>
  {/* Featured episode */}
  {
    featuredEpisode && (
      <div class="mb-8">
        <EpisodeCard
          title={featuredEpisode.data.title}
          slug={featuredEpisode.id.replace(/\.mdx?$/, '')}
          episodeNumber={featuredEpisode.data.episodeNumber}
          description={featuredEpisode.data.description}
          thumbnail={resolveEpisodeCover(featuredEpisode.data, 800)}
          duration={featuredEpisode.data.duration}
          publishDate={featuredEpisode.data.publishDate}
          hook={featuredEpisode.data.hook}
          featured={true}
        />
      </div>
    )
  }

  {/* Episode grid */}
  <div class={`grid ${gridClasses} gap-6`}>
    {
      gridEpisodes.map((episode) => (
        <EpisodeCard
          title={episode.data.title}
          slug={episode.id.replace(/\.mdx?$/, '')}
          episodeNumber={episode.data.episodeNumber}
          description={episode.data.description}
          thumbnail={resolveEpisodeCover(episode.data, 640)}
          duration={episode.data.duration}
          publishDate={episode.data.publishDate}
          hook={episode.data.hook}
        />
      ))
    }
  </div>
</div>
